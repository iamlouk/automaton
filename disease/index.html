<html>
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type"/>
	<title>Disease!</title>
	<style>

	html, body {
		margin: 0px;
		padding: 0px;
		width: 100%;
		height: 100%;
	}

	canvas {
		width: 100%;
		height: 100%;
	}

	#settings {
		position: fixed;
		top: 10px;
		left: 10px;
		margin: 0px;
		border: 1px solid #555555;
		border-radius: 10px;
		padding: 5px;
		z-index: 10;
	}

	label {
		font-family: monospace;
	}

	</style>
</head>
	<canvas id="canvas"></canvas>

	<div id="settings">
		<table>
			<tr>
				<td><label for="speed">Speed: </label></td>
				<td><input type="range" id="speed" min="0.01" max="4" step="0.01" /></td>
			</tr>
		</table>
	</div>

	<script type="module">
		import init, { Simulation } from './pkg/disease.js'

		let speed = 0.1

		document.addEventListener('DOMContentLoaded', async (event) => {
			let canvas = document.getElementById('canvas')
			canvas.width = canvas.offsetWidth
			canvas.height = canvas.offsetHeight

			await init()

			let sim = Simulation.new(canvas.width, canvas.height)
			let prev = Date.now()

			let step = () => {
				let now = Date.now()
				let dt = now - prev
				prev = now

				sim.step(dt * speed)

				window.requestAnimationFrame(step)
			}

			step()
		})

		let speedSlider = document.querySelector('#speed')
		speedSlider.value = speed.toString()
		speedSlider.addEventListener('change', event => {
			speed = Number.parseFloat(speedSlider.value) * 0.1
		})

	</script>
</html>
